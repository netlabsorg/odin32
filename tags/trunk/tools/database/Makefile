# $Id: Makefile,v 1.8 2000-02-12 23:54:29 bird Exp $

#
# Common makefile for database utils. ICC edition
#

# include common definitions
PDWIN32_INCLUDE = ..\..\include
PDWIN32_TOOLS   = ..\bin
!include ..\..\include\pdwin32.mk

# Addjust common definitions
CINCLUDES= -I$(PDWIN32_INCLUDE) -I$(PDWIN32_INCLUDE)\win -Igd -Imysql -I..\common
!ifdef DEBUG
CFLAGS   = $(CFLAGS)   -Ge+ -Tx+ -Tm- $(CINCLUDES)      -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft- -Gh+
CXXFLAGS = $(CXXFLAGS) -Ge+ -Gx- -Tx+ -Tm- $(CINCLUDES) -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft- -Gh+
LDFLAGS  = $(LDFLAGS)  -Ge+ -Fe$@ /B"/MAP:full" $(RTLLIB) os2386.lib cppopa3.obj
!else
CFLAGS   = $(CFLAGS)   -Ge+ -Tx+ $(CINCLUDES)      -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft-
CXXFLAGS = $(CXXFLAGS) -Ge+ -Gx- -Tx+ $(CINCLUDES) -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft-
LDFLAGS  = $(LDFLAGS)  -Ge+ -Fe$@ /B"/MAP:full" $(RTLLIB) os2386.lib
!endif


#
# All roule
#
all: APIImport.exe StateUpd.exe kHTMLPC.exe   \
     ..\bin\APIImport.exe ..\bin\StateUpd.exe \
     ..\bin\kHTMLPC.exe



#
# APIImport
#
APIImport.exe: APIImport.obj db.obj ..\common\commonicc.lib mysql\libmysqlclient.lib
   $(LD) $(LDFLAGS) $**

..\bin\APIImport.exe: APIImport.exe
   $(CP) $** $@

..\common\commonicc.lib:
    cd ..\common
    nmake /nologo commonicc.lib
    cd ..\database



#
# StateUpd
#
StateUpd.exe: StateUpd.obj db.obj mysql\libmysqlclient.lib
   $(LD) $(LDFLAGS) $**

..\bin\StateUpd.exe: StateUpd.exe
   $(CP) $** $@



#
# kHTMLPC - HTML/Sql PreCompiler.
#
kHTMLPC.exe: kHTMLPC.obj db.obj gd/gdicc.lib mysql\libmysqlclient.lib
   $(LD) $(LDFLAGS) $**


..\bin\kHTMLPC.exe: kHTMLPC.exe
   $(CP) $** $@

gd\gdicc.lib: force
   @cd gd
   @nmake /nologo gdicc.lib
   @cd ..




# kHTHMLPC - interference roules for preprocessing of kSqlHtml files.
.SUFFIXES: .html .ksqlhtml .obj
.kSqlHtml.html:
    kHTMLPC $<
.kSqlHtml.obj: # Visual SlickEdit thinks everything complies to .obj files...
    kHTMLPC $<



#
# Odin32 - Creates the database. This will do a drop of any database named "Odin32"!
#
Odin32: CreateTables.sql States.sql Authors.sql
   -mysqladmin refresh
   mysqladmin DROP Odin32
   mysql < CreateTables.sql
   mysql < States.sql
   mysql < Authors.sql
   -mysqladmin refresh

Authors: Authors.sql
   mysql < Authors.sql
   -mysqladmin refresh

States: States.sql
   mysql < States.sql
   -mysqladmin refresh



#
# Autogenerated depenencies.
#
dep:
    $(DEPEND) $(CINCLUDES) *.h *.asm *.inc $(PDWIN32_INCLUDE)\*.h \
        *.c *.cpp -objo *.c *.cpp
    cd gd
    @nmake /nologo dep
    cd ..

!ifndef NODEP
!include .depend
!endif


#
# clean
#
clean:
   $(RM) *.obj *.lib *.o *.a *.dll *.exe *.pch *.log *.map *.html
   cd gd
   $(MAKE) /nologo clean
   cd ..

force:
    @$(ECHO) ...
