# $Id: Makefile,v 1.15 2000-12-02 23:26:58 bird Exp $

#
# Common makefile for database utils. ICC edition
#

# include common definitions
ODIN32_TCOMMON = ..\common
ODIN32_BIN     = $(ODIN32_TOOLS)
!include ../../makefile.inc
!include $(ODIN32_TCOMMON)/common.mk

# Addjust common definitions
CINCLUDES= -I$(ODIN32_INCLUDE) -I$(ODIN32_INCLUDE)\win -Igd -Imysql -I..\common
!ifdef DEBUG
CFLAGS   = $(CFLAGS)   -Ge+ -Tx+ -Tm- $(CINCLUDES)      -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft- -Gh+ -DDEBUG_ALLOC
CXXFLAGS = $(CXXFLAGS) -Ge+ -Gx- -Tx+ -Tm- $(CINCLUDES) -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft- -Gh+ -DDEBUG_ALLOC
LDFLAGS  = $(LDFLAGS)  -Ge+ -Fe$@ /B"/MAP:full /STACK:0x50000" $(RTLLIB) os2386.lib cppopa3.obj
!else
CFLAGS   = $(CFLAGS)   -Ge+ -Tx+ $(CINCLUDES)      -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft-
CXXFLAGS = $(CXXFLAGS) -Ge+ -Gx- -Tx+ $(CINCLUDES) -DNO_CLIENT_LONG_LONG -Wall+ppt-ppc-inl-cnv-gnr-vft-
LDFLAGS  = $(LDFLAGS)  -Ge+ -Fe$@ /B"/MAP:full /STACK:0x50000" $(RTLLIB) os2386.lib
!endif


#
# All roule
#
all: APIImport.exe StateUpd.exe kHTMLPC.exe   \
     ..\bin\APIImport.exe ..\bin\StateUpd.exe \
     ..\bin\kHTMLPC.exe



#
# APIImport
#
APIImport.exe: APIImport.obj db.obj $(COMMONLIB) mysql\libmysqlclient.lib
   $(LD) $(LDFLAGS) $**

..\bin\APIImport.exe: APIImport.exe
   $(CP) $** $@



#
# StateUpd
#
StateUpd.exe: StateUpd.obj db.obj mysql\libmysqlclient.lib
   $(LD) $(LDFLAGS) $**

..\bin\StateUpd.exe: StateUpd.exe
   $(CP) $** $@



#
# kHTMLPC - HTML/Sql PreCompiler.
#
kHTMLPC.exe: kHTMLPC.obj db.obj gd/gdicc.lib mysql\libmysqlclient.lib
   $(LD) $(LDFLAGS) $**


..\bin\kHTMLPC.exe: kHTMLPC.exe
   $(CP) $** $@

gd\gdicc.lib: force
   $(DODIRS) "gd" $(MAKE_CMD) gdicc.lib



# kHTHMLPC - interference roules for preprocessing of kSqlHtml files.
.SUFFIXES: .html .ksqlhtml .obj
.kSqlHtml.html:
    kHTMLPC $<
.kSqlHtml.obj: # Visual SlickEdit thinks everything complies to .obj files...
    kHTMLPC $<



#
# Odin32 - Creates the database. This will do a drop of any database named "Odin32"!
#
Odin32: CreateTables.sql States.sql Authors.sql
   -mysqladmin refresh
   mysqladmin DROP Odin32
   mysql < CreateTables.sql
   mysql < States.sql
   mysql < Authors.sql
   -mysqladmin refresh

Authors: Authors.sql
   mysql < Authors.sql
   -mysqladmin refresh

States: States.sql
   mysql < States.sql
   -mysqladmin refresh



#
# Autogenerated depenencies.
#
dep:
    $(DEPEND) $(CINCLUDES) -o- *.h *.asm *.inc $(ODIN32_INCLUDE)\*.h \
        *.c *.cpp -objo *.c *.cpp
    $(DODIRS) "gd" $(MAKE_CMD) dep



#
# clean
#
clean:
   $(RM) *.obj *.lib *.o *.a *.dll *.exe *.pch *.log *.map *.html
    $(DODIRS) "gd" $(MAKE_CMD) clean



#
# Include the .depend file.
#   If the depend file don't exists we'll complain about it.
#
!ifndef NODEP
!   if [$(EXISTS) .depend] == 0
!       include .depend
!   else
!       if [$(ECHO) .depend doesn't exist]
!       endif
!   endif
!endif



force:
    @$(ECHO) ...


#
# Common rules.
#
!include $(ODIN32_TCOMMON_POST_INC)

